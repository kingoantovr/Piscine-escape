<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Piscine Escape – WebXR (clean)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- Environnement prêt à l'emploi (ciel/sol/lumière) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

  <!-- Déplacement Quest (stick gauche) -->
  <script>
    AFRAME.registerComponent('q3-move', {
      schema:{speed:{type:'number',default:2.4}, camera:{type:'selector'}},
      init(){
        this.input={x:0,y:0};
        const left = document.querySelector('#leftHand');
        if (left) {
          left.addEventListener('thumbstickmoved', e=>{
            this.input.x = (e.detail && e.detail.x) || 0;
            this.input.y = (e.detail && e.detail.y) || 0;
          });
        }
      },
      tick(t,dt){
        const d = (dt||0)/1000; if(!d) return;
        const rig = this.el.object3D;
        const cam = (this.data.camera||document.querySelector('#camera')).object3D;
        const f = new THREE.Vector3(0,0,-1).applyQuaternion(cam.quaternion); f.y=0; f.normalize();
        const r = new THREE.Vector3(1,0,0).applyQuaternion(cam.quaternion);  r.y=0; r.normalize();
        const m = new THREE.Vector3().addScaledVector(r,this.input.x).addScaledVector(f,-this.input.y);
        if (m.lengthSq()>0){ m.normalize().multiplyScalar(this.data.speed*d); rig.position.add(m); }
      }
    });
  </script>

  <style>
    #hud{position:fixed;left:12px;top:12px;z-index:9999;background:rgba(0,0,0,.55);color:#fff;
      font-family:system-ui,sans-serif;padding:10px 12px;border-radius:10px;line-height:1.4;font-size:13px}
  </style>
</head>
<body>
  <div id="hud">Enter VR • Stick gauche = marcher • Trigger = téléporter • Grip = saisir</div>

  <a-scene renderer="antialias: true; physicallyCorrectLights: true" background="color: #dfefff">
    <!-- Environnement automatique (joli ciel + sol texturé) -->
    <a-entity environment="preset: forest; lighting: distant; ground: canyon; groundTexture: walkernoise"></a-entity>

    <!-- Sol invisible mais téléportable (grand disque) -->
    <a-circle class="teleportable" radius="25" rotation="-90 0 0" color="#000" opacity="0" visible="true"></a-circle>

    <!-- Bassin simple -->
    <a-box position="0 0.25 -6" depth="8" height="0.5" width="12" color="#1E90FF" material="opacity:0.7; transparent:true"></a-box>
    <a-box position="0 0.6 -2" depth="0.5" height="1.2" width="12" color="#E5E5E5"></a-box>
    <a-box position="0 0.6 -10" depth="0.5" height="1.2" width="12" color="#E5E5E5"></a-box>
    <a-box position="-6 0.6 -6" depth="8" height="1.2" width="0.5" color="#E5E5E5"></a-box>
    <a-box position="6 0.6 -6" depth="8" height="1.2" width="0.5" color="#E5E5E5"></a-box>

    <!-- Objets à manipuler -->
    <a-box position="-1 1.2 -4.5" depth="0.45" height="0.45" width="0.45" color="#ff6b6b"></a-box>
    <a-sphere position="1 1.6 -5.2" radius="0.28" color="#ffd93d"></a-sphere>
    <a-cylinder position="0 1.3 -7" radius="0.22" height="0.55" color="#6bcb77"></a-cylinder>

    <!-- Joueur -->
    <a-entity id="rig" position="0 0 -3" q3-move="speed:2.4; camera:#camera">
      <a-entity id="camera" camera look-controls position="0 1.6 0"></a-entity>

      <!-- Mains + téléportation (trigger) -->
      <a-entity id="leftHand"
        hand-controls="hand: left; handModelStyle: lowPoly; color:#4fc3f7"
        teleport-controls="cameraRig:#rig; teleportOrigin:#camera; button: trigger; collisionEntities:.teleportable; enabled:true"></a-entity>

      <a-entity id="rightHand"
        hand-controls="hand: right; handModelStyle: lowPoly; color:#ffab40"
        teleport-controls="cameraRig:#rig; teleportOrigin:#camera; button: trigger; collisionEntities:.teleportable; enabled:true"></a-entity>
    </a-entity>
  </a-scene>
</body>
</html>
