<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Piscine Escape – WebXR (TP + Move + Grab)</title>

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Physique (cannon-es) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@6.1.0/dist/aframe-physics-system.min.js"></script>

  <!-- Super Hands (grabbable/draggable/stretchable) -->
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.6/dist/super-hands.min.js"></script>

  <!-- Movement controls (smooth locomotion + WASD/gamepad) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.7.0/dist/aframe-extras.min.js"></script>

  <!-- Téléportation (built-in A-Frame component) -->
  <script>
    // petit helper pour toggler les modes
    function useTeleport() {
      const rig = document.querySelector('#rig');
      rig.setAttribute('movement-controls', 'enabled: false'); // coupe le move libre
      document.querySelectorAll('.tpctrl').forEach(el => el.setAttribute('teleport-controls', 'enabled: true'));
      document.querySelector('#modeLabel').textContent = 'Mode: Téléportation';
    }
    function useSmooth() {
      const rig = document.querySelector('#rig');
      rig.setAttribute('movement-controls', 'enabled: true'); // active le move libre
      document.querySelectorAll('.tpctrl').forEach(el => el.setAttribute('teleport-controls', 'enabled: false'));
      document.querySelector('#modeLabel').textContent = 'Mode: Mouvement libre';
    }
    document.addEventListener('DOMContentLoaded', () => {
      // défaut : mouvement libre
      useSmooth();
    });
  </script>

  <style>
    /* Petit HUD pour basculer de mode */
    #ui {
      position: fixed; left: 12px; top: 12px; z-index: 9999;
      background: rgba(0,0,0,.55); color: #fff; font-family: system-ui, sans-serif;
      padding: 10px 12px; border-radius: 8px; line-height: 1.4;
    }
    #ui button { margin-right: 6px; }
  </style>
</head>
<body>
  <!-- HUD desktop/mobile (en VR, utilisez les sticks/gâchettes) -->
  <div id="ui">
    <div id="modeLabel">Mode: …</div>
    <button onclick="useTeleport()">Téléportation</button>
    <button onclick="useSmooth()">Mouvement libre</button>
    <div style="margin-top:6px; font-size:12px; opacity:.9">
      PC: ZQSD/WASD pour bouger, souris pour regarder. <br/>
      VR: stick pour avancer, <b>trigger</b> pour téléporter, <b>grip</b> pour saisir.
    </div>
  </div>

  <a-scene physics="debug: false">
    <!-- Lumières & ciel -->
    <a-sky color="#87CEFA"></a-sky>
    <a-entity light="type: ambient; intensity: 0.45"></a-entity>
    <a-entity light="type: directional; intensity: 0.9" position="0 6 3"></a-entity>

    <!-- Sol (statique) + zone téléportable -->
    <a-plane class="floor teleportable" rotation="-90 0 0" width="26" height="26"
             color="#C2B280" static-body></a-plane>

    <!-- Bassin “piscine” -->
    <a-box position="0 0.25 -5" depth="8" height="0.5" width="12"
           color="#1E90FF" material="opacity:0.6; transparent:true"></a-box>
    <!-- Murets de piscine (statique) -->
    <a-box position="0 0.6 -1" depth="0.5" height="1.2" width="12" color="#eaeaea" static-body></a-box>
    <a-box position="0 0.6 -9" depth="0.5" height="1.2" width="12" color="#eaeaea" static-body></a-box>
    <a-box position="-6 0.6 -5" depth="8" height="1.2" width="0.5" color="#eaeaea" static-body></a-box>
    <a-box position="6 0.6 -5" depth="8" height="1.2" width="0.5" color="#eaeaea" static-body></a-box>

    <!-- Quelques objets à attraper -->
    <a-box position="-1 1.2 -3.5" depth="0.4" height="0.4" width="0.4" color="#ff6b6b"
           class="grabbable" dynamic-body></a-box>
    <a-sphere position="1 1.6 -4.2" radius="0.25" color="#ffd93d"
              class="grabbable" dynamic-body></a-sphere>
    <a-cylinder position="0 1.4 -6" radius="0.2" height="0.5" color="#6bcB77"
                class="grabbable" dynamic-body></a-cylinder>

    <!-- RIG joueur -->
    <a-entity id="rig" movement-controls="fly: false; speed: 0.18">
      <!-- Caméra -->
      <a-entity id="camera" camera look-controls position="0 1.6 2"></a-entity>

      <!-- Contrôleur gauche : téléport + super-hands -->
      <a-entity class="tpctrl"
                hand-controls="hand: left; handModelStyle: lowPoly; color: #4fc3f7"
                teleport-controls="cameraRig: #rig; teleportOrigin: #camera; button: trigger; collisionEntities: .teleportable; enabled: false"
                super-hands
                sphere-collider="objects: .grabbable">
      </a-entity>

      <!-- Contrôleur droit : téléport + super-hands -->
      <a-entity class="tpctrl"
                hand-controls="hand: right; handModelStyle: lowPoly; color: #ffab40"
                teleport-controls="cameraRig: #rig; teleportOrigin: #camera; button: trigger; collisionEntities: .teleportable; enabled: false"
                super-hands
                sphere-collider="objects: .grabbable">
      </a-entity>
    </a-entity>

    <!-- Petites instructions in-world -->
    <a-text value="Piscine Escape • Grip = saisir • Trigger = téléporter (si mode TP)"
            position="-2 2 -2" width="6" color="#111"></a-text>
  </a-scene>
</body>
</html>
